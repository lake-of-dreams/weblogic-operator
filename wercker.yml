# The container definition we want to use for developing our app
box: golang
build:
  steps:
    - setup-go-workspace:
        package-dir: github.com/sczachariah/weblogic-operator

    - script:
        name: prerequiste - env setup
        code: |
          export GOROOT=/usr/local/go
          export GOPATH=$HOME/go
          export GOBIN=$GOPATH/bin
          export PATH=$GOPATH:$GOBIN:$PATH
          cd $GOPATH/src
          git clone https://github.com/sczachariah/weblogic-operator.git

    - script:
        name: install go tools
        code: |
          go version
          go get -u -v github.com/golang/dep
          go get -u -v github.com/golang/dep/cmd/dep

    - script:
        name: install dependencies
        code: |
          dep ensure
          make vendor

    # Statically build the project
    - script:
        name: build the project
        code:
          cd $WERCKER_SOURCE_DIR
          make build

    #Push the latest image of the weblogic-operator
    - script:
        name: Push the latest image of the weblogic-operator
        code:
          make push

    # Copy binary to a location that gets passed along to the deploy pipeline
    - script:
        name: copy to deployment directory
        code: |
          echo $WERCKER_OUTPUT_DIR
          cp -av dist/bin/weblogic-operator "$WERCKER_OUTPUT_DIR"