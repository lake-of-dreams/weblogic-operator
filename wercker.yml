# The container definition we want to use for developing our app
box: golang
build:
  steps:
    - setup-go-workspace:
        package-dir: github.com/sczachariah/weblogic-operator

    - script:
        name: install go tools
        code: |
          go version
          go get -u -v github.com/golang/dep
          go get -u -v github.com/golang/dep/cmd/dep
          go env GOPATH

    - script:
        name: install dependencies
        code: |
          dep ensure
          cd `pwd`/../../../
          git clone https://github.com/sczachariah/weblogic-operator.git ./github.com/sczachariah/weblogic-operator
          cd /go/src/github.com/sczachariah/weblogic-operator
          make vendor
          set GOROOT=/usr/local/go
          set GOPATH=$HOME/go
          set GOBIN=$GOPATH/bin
          set PATH=$GOPATH:$GOBIN:$PATH

    # Statically build the project
    - script:
        name: build the project
        code:
          make build

    #Push the latest image of the weblogic-operator
    - script:
        name: Push the latest image of the weblogic-operator
        code:
          make push

    # Copy binary to a location that gets passed along to the deploy pipeline
    - script:
        name: copy to deployment directory
        code: |
          echo $WERCKER_OUTPUT_DIR
          cp -av dist/bin/weblogic-operator "$WERCKER_OUTPUT_DIR"