# The container definition we want to use for developing our app
box: golang
build:
 steps:
   - setup-go-workspace:
      package-dir: weblogic-operator

   - script:
      name: install go tools
      code: |
       go version
       go get -u -v github.com/golang/dep
       go get -u -v github.com/golang/dep/cmd/dep

   - script:
      name: install dependencies
      code: |
       dep ensure
       cd `pwd`/../../../
       git clone https://github.com/sczachariah/weblogic-operator.git weblogic-operator
       cd /go/src/weblogic-operator
       make vendor
       set GOROOT=/usr/local/go
       set GOPATH=$HOME/go
       set GOBIN=$GOPATH/bin
       set PATH=$GOPATH:$GOBIN:$PATH

   # Statically build the project
   - script:
      name: build the project
      code: |
       make build

deploy:
 box: node:4-slim
 steps:
   - internal/shell:
      cmd: /bin/sh  #defaults to /bin/bash
      code: |
       # some code to automatically run in your shell session
       # before you start interacting
       set DOCKER_USER = "fmwplt"
       set OPERATOR_DOCKER_IMAGE_NAME = "weblogic-operator"
       set OPERATOR_DOCKER_IMAGE_TAG = $(shell date +%y%m%d%H%M)
       set http_proxy = "http://www-proxy.us.oracle.com:80"
       set https_proxy = "http://www-proxy.us.oracle.com:80"
       sed "s/{{VERSION}}/$(OPERATOR_DOCKER_IMAGE_TAG)/g" manifests/weblogic-operator-template.yaml > manifests/weblogic-operator.yaml

   - script:
      name: building a image fo weblogic-operator
      code: |
       uname -a
       sudo apt-get update
       echo 1
       sudo apt-get install  apt-transport-https \
       ca-certificates \
       curl \
       software-properties-common | echo "Y"
       echo 2
       curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
       echo 3
       sudo apt-key fingerprint 0EBFCD88
       echo 4
       sudo apt-get update
       echo 5
       sudo apt-get install
       echo 6
       sudo usermod -aG docker ${whoami}
       sudo docker run hello-world
       sudo docker ps
       sudo docker info
#       /usr/sbin/addgroup docker
#       sudo /usr/sbin/adduser -G docker vpriyankaprabhu | echo "password123" >> /dev/null
#       echo 'export DOCKER_HOST="tcp://$(boot2docker ip 2>/dev/null):2375";' >> ~/.bashrc
#       sudo chgrp docker /usr/local/bin/docker
#       set DOCKER_HOST=unix:///var/run/docker.sock
#       find / -name wget -print
#   - internal/docker-push:
#      name: push the operator image to repo
#      #tag: ${OPERATOR_DOCKER_IMAGE_NAME}:${OPERATOR_DOCKER_IMAGE_TAG} ${DOCKER_USER}/${OPERATOR_DOCKER_IMAGE_NAME}:${OPERATOR_DOCKER_IMAGE_TAG}
#      working-dir: /pipeline/source
#      repository: quay.io/fmwplt/weblogic-operator
#      username: ${QUAY_IO_USERNAME}
#      password: ${QUAY_IO_PASSWORD}