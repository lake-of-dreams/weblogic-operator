# The container definition we want to use for developing our app
box: golang
build:
 steps:
   - setup-go-workspace:
      package-dir: weblogic-operator

   - script:
      name: install go tools
      code: |
       go version
       go get -u -v github.com/golang/dep
       go get -u -v github.com/golang/dep/cmd/dep

   - script:
      name: install dependencies
      code: |
       dep ensure
       cd `pwd`/../../../
       git clone https://github.com/sczachariah/weblogic-operator.git weblogic-operator
       cd /go/src/weblogic-operator
       make vendor
       set GOROOT=/usr/local/go
       set GOPATH=$HOME/go
       set GOBIN=$GOPATH/bin
       set PATH=$GOPATH:$GOBIN:$PATH

   # Statically build the project
   - script:
      name: build the project
      code: |
       make build

deploy:
 box: docker
 steps:
   - script:
     name: docker commands
     code: |
      curl -fsSL https://get.docker.com | sh;
      sudo service docker start
      sudo docker run hello-world
      sudo groupadd docker && sudo usermod -aG docker ${whoami}
      env | grep DOCKER

#   - internal/docker-push:
#      name: push the operator image to repo
#      #tag: ${OPERATOR_DOCKER_IMAGE_NAME}:${OPERATOR_DOCKER_IMAGE_TAG} ${DOCKER_USER}/${OPERATOR_DOCKER_IMAGE_NAME}:${OPERATOR_DOCKER_IMAGE_TAG}
#      working-dir: /pipeline/source
#      repository: quay.io/fmwplt/weblogic-operator
#      username: ${QUAY_IO_USERNAME}
#      password: ${QUAY_IO_PASSWORD}