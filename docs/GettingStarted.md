# MySQL Operator Setup

This guide provides a quick start for users of the Oracle MySQL Operator

## Prerequisites

* Kubernetes
* Password for ODX docker registry

#### Create a Docker secret for the registry password

First create the namespace that the operator will reside in (this is a temporary measure that's needed for the secret creation
below to succeed).

```
kubectl create ns mysql-operator
```

Next, export a docker secret which holds the ODX Docker Registry password. Our images are published to a shared
private Docker registry. Until there are public repos available, you will need a secret to pull images from this repository.

You will need to create a secret in **both** the default and mysql-operator namespace.

```
kubectl -n mysql-operator create secret docker-registry odx-docker-pull-secret \
--docker-server="registry.oracledx.com" \
--docker-username="agent" \
--docker-password="XXX" \
--docker-email="k8s@oracle.com"

kubectl create secret docker-registry odx-docker-pull-secret \
--docker-server="registry.oracledx.com" \
--docker-username="agent" \
--docker-password="XXX" \
--docker-email="k8s@oracle.com"
```



#### Deploy a version of the MySQL Operator

Deploy the latest MySQL Operator. The MySQL Operator runs in it's own namespace by default.

```
kubectl apply -f https://gitlab-odx.oracle.com/odx/weblogic-operator/raw/master/manifests/mysql-operator-latest.yaml
```

Check to see if the operator is running. You should see a single MySQL Operator instance running

```
$ kubectl -n mysql-operator get po
NAME                              READY     STATUS    RESTARTS   AGE
mysql-operator-1281129797-k7q9x   1/1       Running   0          9m
```

#### Create a simple MySQL cluster

Now let's create a new MySQL cluster. Create a cluster.yaml file with the following contents

```yaml
apiVersion: mysql.oracle.com/v1
kind: MySQLCluster
metadata:
  name: mysql
```

And create it with **kubectl**

```
$ kubectl apply -f cluster.yaml
mysqlcluster "mysql" created
```

You should now a cluster in the default namespace

```
$ kubectl get mysqlclusters
NAME      KIND
mysql     MySQLCluster.v1.mysql.oracle.com
```

#### Verify we can connect to MySQL

The first thing we need to do is fetch the MySQL root password which is autogenerated for us by default.

```
$ kubectl exec -it mysql-0 -- bash -c 'env | grep MYSQL_ROOT_PASSWORD'
MYSQL_ROOT_PASSWORD=ETdmMKh2UuDq9m7y
```

We can use a MySQL client container to verify we can connect to MySQL inside the Kubernetes cluster.

```
$ kubectl run mysql-client --image=mysql:5.7 -i -t --rm --restart=Never \
    -- mysql -h mysql-0.mysql -uroot -pETdmMKh2UuDq9m7y -e 'SELECT 1'
Waiting for pod default/mysql-client to be running, status is Pending, pod ready: false
mysql: [Warning] Using a password on the command line interface can be insecure.
+---+
| 1 |
+---+
| 1 |
+---+
```

You can then execute any further commands via 'kubectl exec' against the 'mysql' 
container:

```
$ kubectl exec -it -c mysql mysql-0 \
    -- mysql -h mysql-0.mysql -uroot -pI5iziqL6tHqHTVZK -e 'SELECT 1'
+---+
| 1 |
+---+
| 1 |
+---+
```


